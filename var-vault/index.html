<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>VAR Vault â€“ FPL League Payouts</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 16px;
      background: #0b1020;
      color: #f5f5f5;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    h1, h2, h3 {
      margin: 0 0 12px 0;
    }

    .card {
      background: #151a30;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }

    .meta-line {
      font-size: 13px;
      color: #9ca3af;
    }

    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    .tab-button {
      flex: 1;
      text-align: center;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid #3b82f6;
      background: transparent;
      color: #e5e7eb;
      cursor: pointer;
      font-size: 14px;
    }

    .tab-button.active {
      background: #3b82f6;
      color: white;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    th, td {
      padding: 8px;
      text-align: left;
    }

    th {
      border-bottom: 1px solid #374151;
      font-weight: 600;
    }

    tr:nth-child(even) {
      background: rgba(55, 65, 81, 0.3);
    }

    tr:nth-child(odd) {
      background: transparent;
    }

    .pill {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(16, 185, 129, 0.2);
      color: #6ee7b7;
      font-size: 12px;
      margin-right: 4px;
    }

    @media (max-width: 600px) {
      table { font-size: 12px; }
      th, td { padding: 6px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>VAR Vault</h1>
    <p class="meta-line" id="last-updated">Loading...</p>

    <div id="meta" class="card"></div>

    <div class="card">
      <div class="tabs">
        <button class="tab-button active" data-tab="standings">Standings</button>
        <button class="tab-button" data-tab="weekly">Weekly Winners</button>
      </div>

      <div id="standings" class="tab-content"></div>
      <div id="weekly" class="tab-content" style="display: none;"></div>
    </div>
  </div>

  <script>
    async function loadData() {
      try {
        const res = await fetch('fpl_results.json?_=' + Date.now());
        const data = await res.json();
        renderLastUpdated(data);
        renderMeta(data);
        renderStandings(data.players, data.max_gameweek, data.league_name);
        renderWeekly(data.weekly_results);
      } catch (e) {
        document.getElementById('last-updated').textContent =
          'Failed to load data. Did you run the update script?';
        console.error(e);
      }
    }

    function renderLastUpdated(data) {
      const el = document.getElementById('last-updated');
      if (data.updated_at) {
        const dt = new Date(data.updated_at);
        el.textContent = `Last updated: ${dt.toLocaleString()}`;
      } else {
        el.textContent = 'Last updated: unknown';
      }
    }

    function renderMeta(data) {
      const meta = document.getElementById('meta');
      meta.innerHTML = `
        <h2>${data.league_name || 'League'} (${data.league_id})</h2>
        <p>Up to Gameweek <strong>${data.max_gameweek}</strong></p>
        <p>
          <span class="pill">Buy-in: $30</span>
          <span class="pill">GW Win: $5</span>
          <span class="pill">Final pot: 70 / 30 / 10</span>
        </p>
      `;
    }

    function renderStandings(players, maxGw, leagueName) {
      const container = document.getElementById('standings');
      const rows = players.map((p, idx) => `
        <tr>
          <td>${idx + 1}</td>
          <td>${p.name}</td>
          <td>${p.team_name || ''}</td>
          <td>${p.total_points}</td>
          <td>$${p.earnings.toFixed(2)}</td>
        </tr>
      `).join('');

      container.innerHTML = `
        <h3>Standings after GW ${maxGw}</h3>
        <table>
          <thead>
            <tr>
              <th>Rank</th>
              <th>Manager</th>
              <th>Team</th>
              <th>Total Points</th>
              <th>Earnings ($)</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
      `;
    }

    function renderWeekly(weeklyResults) {
      const container = document.getElementById('weekly');
      if (!weeklyResults.length) {
        container.innerHTML = '<p>No finished gameweeks yet.</p>';
        return;
      }

      const rows = weeklyResults.map(r => `
        <tr>
          <td>${r.gw}</td>
          <td>${r.name}</td>
          <td>${r.team_name || ''}</td>
          <td>$${r.prize.toFixed(2)}</td>
        </tr>
      `).join('');

      container.innerHTML = `
        <h3>Weekly Winners</h3>
        <table>
          <thead>
            <tr>
              <th>Gameweek</th>
              <th>Manager</th>
              <th>Team</th>
              <th>Prize ($)</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
      `;
    }

    // Tab switching
    document.addEventListener('click', (e) => {
      if (!e.target.classList.contains('tab-button')) return;

      const tab = e.target.getAttribute('data-tab');
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.toggle('active', btn.getAttribute('data-tab') === tab);
      });
      document.querySelectorAll('.tab-content').forEach(div => {
        div.style.display = (div.id === tab) ? 'block' : 'none';
      });
    });

    loadData();
  </script>
</body>
</html>
